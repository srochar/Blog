<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Sensor Proximidad
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="http://alumnos.informatica.utem.cl/~srocha/theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://alumnos.informatica.utem.cl/~srocha/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://alumnos.informatica.utem.cl/~srocha/theme/css/main.css">

    <link rel="stylesheet" href="http://alumnos.informatica.utem.cl/~srocha/theme/css/blog.css">
    <link rel="stylesheet" href="http://alumnos.informatica.utem.cl/~srocha/theme/css/github.css">
        <script src="http://alumnos.informatica.utem.cl/~srocha/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
        <a id="site-title" href="http://alumnos.informatica.utem.cl/~srocha"><h1><i class="icon-desktop"></i> De todo un Seba</h1></a>
        <p id="site-desc"></p>
    </hgroup>
    <nav>
        <ul id="nav-links">
                <li><a href="http://alumnos.informatica.utem.cl/~srocha/">Blog</a></li>
                <li><a href="http://alumnos.informatica.utem.cl/~srocha/pages/contacto">Quién soy</a></li>
        </ul>
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by <a href="https://github.com/hdra/pelican-cait" target="github">hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2013-09-11T00:00:00" pubdate>
                            mié 11 septiembre 2013
                        </time>
                        <a href="http://alumnos.informatica.utem.cl/~srocha/sensor-proximidad.html" rel="bookmark"><h1>Sensor Proximidad</h1></a>
                    </header>

                    <section class="post-content">
                        <p>Tengo en mis manos un sensor de proximidad que utiliza un infrarrojo; <a href="http://alumnos.informatica.utem.cl/~srocha/Download/Sensor%20de%20Proximidad/GP2Y0A21YK.pdf" title="Manual PDF">GP2Y0A21</a>. Buscando en internet para saber cómo hacerlo funcionar con arduino no encontré mucha información, debido a esto les explicaré cómo hacer para sacar provecho de este dispositivo.</p>
<p><img alt="Sensor" src="http://alumnos.informatica.utem.cl/~srocha/imagenes/Sensor%20de%20Proximidad/GP2Y0A21.jpg" title="Sensor GP2Y0A21" /></p>
<p>Es fácil entender el cómo funciona y se calcula la distancia. Se envía una señal que al dar con el objeto rebota y llega devuelta al dispositivo. Dependiendo del valor que llega y calculando por un gráfico se puede saber la distancia. Lo que se recibe es "tensión" que puede variar dependiendo del color del objeto que la cantidad de luz que este cerca.</p>
<p>Cable rojo voltaje 5v, amarillo conectado a un análogo y negro a tierra. </p>
<p><img alt="Conexión sensor proximidad" src="http://alumnos.informatica.utem.cl/~srocha/imagenes/Sensor%20de%20Proximidad/conexion.png" title="Conexión" /></p>
<p>Acá les presento el gráfico tensión vs distancia. </p>
<p><img alt="Grafico" src="http://alumnos.informatica.utem.cl/~srocha/imagenes/Sensor%20de%20Proximidad/Grafico.png" title="Grafico" /></p>
<p>Deben tener ojo si observan entre 0 - 10 cm se pueden obtener dos tensiones. Si no entiende pueden ver el valor de 1V tiene dos valores 3 cm y 26 cm (aproximadamente). Para evitar estos problemas eviten que la distancia al objeto sea menor a 10 cm.</p>
<p>Habrá que hacer una estimación de esa función yo la hice en excel. Pero obviamente existen más.</p>
<p>Vean el excel para que se vean como logre dar con la función. <a href="http://alumnos.informatica.utem.cl/~srocha/Download/Sensor%20de%20Proximidad/Estimador.xls">Download excel</a></p>
<p><img alt="Funcion estimada" src="http://alumnos.informatica.utem.cl/~srocha/imagenes/Sensor%20de%20Proximidad/Grafico%20Estimado.png" title="Funcion Generada por excel" /></p>
<p>Habría que calcular la función inversa para que nosotros al darle un valor en tensión nos de vuelva el valor en cm. <a href="http://www.wolframalpha.com/input/?i=inverse+y+%3D+14.8*x^%28-0.82%29" title="Wolframalpha">Inversa</a></p>
<p>Ok ya se entiende cómo funciona y sabemos cómo calcular la distancia. Llevemos esto a programación y arduino :).</p>
<p>Así debiera funcionar: el dispositivo recibe una señal (que será de 0 a 1023) vía pin análogo, con una simple función (que ya obtuvimos) medimos la distancia.</p>
<p>Pero hay un problema; el valor que nos entrega el pin análogo es un valor entre 0 a 1023, para "transformar" el valor de bit a tensión se aplica una simple regla de tres. 0 -&gt; 0 y 1023 -&gt; 5</p>
<p>Una función simple en arduino sería:</p>
<div class="highlight"><pre><span class="kt">float</span> <span class="nf">anal_to_tens</span><span class="p">(</span><span class="kt">int</span> <span class="n">ana_value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ana_value</span><span class="o">*</span><span class="mf">5.0</span><span class="p">)</span><span class="o">/</span><span class="mi">1023</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Falta sólo la función que devuelva el valor en cm.</p>
<div class="highlight"><pre><span class="kt">float</span> <span class="nf">ir_toCm</span><span class="p">(</span><span class="kt">int</span> <span class="n">pinIR</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span> <span class="n">tension</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">pinValue</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">valueCm</span><span class="p">;</span>
  <span class="n">pinValue</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">pinIR</span><span class="p">);</span>
  <span class="n">tension</span> <span class="o">=</span> <span class="n">anal_to_tens</span><span class="p">(</span><span class="n">pinValue</span><span class="p">);</span>

  <span class="n">valueCm</span> <span class="o">=</span> <span class="mf">26.7392</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">tension</span><span class="p">,</span><span class="mf">1.21951219512</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">valueCm</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Y esto sería todo, prueben, acá les dejo el código completo:</p>
<div class="highlight"><pre><span class="kt">float</span> <span class="n">distancia</span><span class="p">;</span>

<span class="kt">float</span> <span class="nf">anal_to_tens</span><span class="p">(</span><span class="kt">int</span> <span class="n">ana_value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">ana_value</span><span class="o">*</span><span class="mf">5.0</span><span class="p">)</span><span class="o">/</span><span class="mi">1023</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">ir_toCm</span><span class="p">(</span><span class="kt">int</span> <span class="n">pinIR</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span> <span class="n">tension</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">pinValue</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">valueCm</span><span class="p">;</span>
  <span class="n">pinValue</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">pinIR</span><span class="p">);</span>
  <span class="n">tension</span> <span class="o">=</span> <span class="n">anal_to_tens</span><span class="p">(</span><span class="n">pinValue</span><span class="p">);</span>

  <span class="n">valueCm</span> <span class="o">=</span> <span class="mf">26.7392</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">tension</span><span class="p">,</span><span class="mf">1.21951219512</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">valueCm</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">distancia</span> <span class="o">=</span> <span class="n">ir_toCm</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Distancia : &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">distancia</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; Cm&quot;</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="http://alumnos.informatica.utem.cl/~srocha/category/misc.html">misc</a></p>
                        <p>Tags: <a href="http://alumnos.informatica.utem.cl/~srocha/tag/proximidad.html">proximidad</a>, <a href="http://alumnos.informatica.utem.cl/~srocha/tag/sensor.html">sensor</a>, <a href="http://alumnos.informatica.utem.cl/~srocha/tag/arduinio.html">arduinio</a>, <a href="http://alumnos.informatica.utem.cl/~srocha/tag/serial.html">serial</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'detodounseba';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

<script>
    var _gaq=[['_setAccount','UA-4505-7407'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
        <script src="http://alumnos.informatica.utem.cl/~srocha/theme/js/main.js"></script>
    </body>
</html>